<div class="space-y-6 text-gray-100">
  <!-- Cabeçalho -->
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
    <h1 class="text-2xl font-bold text-gray-100">Quadro de Tarefas</h1>

     <div class="join">
      <button class="btn btn-sm join-item" [class.btn-primary]="filterState() === 'my-organizations'" (click)="filterState.set('my-organizations')" [disabled]="isNationalAdmin()">Minhas Comissões</button>
      <button class="btn btn-sm join-item" [class.btn-primary]="filterState() === 'all'" (click)="filterState.set('all')">Todas</button>
    </div>

    <button
      (click)="onNewTask()"
      class="btn btn-primary flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-300 hover:scale-[1.03] active:scale-[0.97]"
    >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
      </svg>
      Nova Tarefa
    </button>
  </div>

  <!-- Colunas -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" cdkDropListGroup>
    <!-- Coluna: A Fazer -->
    <div class="card bg-gray-800 border border-gray-700 shadow-lg">
      <div class="card-body">
        <h2 class="card-title justify-center">
          <span class="badge badge-info badge-lg text-white p-3">A Fazer</span>
        </h2>

        <div id="todo" class="space-y-4 min-h-96 p-2 rounded-lg" cdkDropList [cdkDropListData]="todoTasks()" (cdkDropListDropped)="onTaskDrop($event)">
          @for (task of todoTasks(); track task.id) {
          <div
  class="card bg-gray-700/80 border border-gray-600 hover:border-primary/70 shadow-lg cursor-grab active:cursor-grabbing transition-all relative rounded-xl backdrop-blur-sm hover:shadow-primary/10"
  cdkDrag
  [cdkDragData]="task"
>
  <div class="card-body space-y-3">
    <!-- Título e botão de opções -->
    <div class="flex justify-between items-start">
      <h3 class="font-semibold text-gray-100 leading-tight pr-8">
        {{ task.title }}
      </h3>

      <button
        (click)="onEditTask(task)"
        class="btn btn-ghost btn-xs text-gray-400 hover:text-white hover:bg-gray-600 rounded-md p-1"
      >
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 20 20"
             fill="currentColor"
             class="w-5 h-5">
          <path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 5.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3z" />
        </svg>
      </button>
    </div>

    <!-- Descrição -->
    <p class="text-sm text-gray-400 line-clamp-3">
      {{ task.description }}
    </p>

    <!-- Badges e avatar -->
    <div class="flex justify-between items-center pt-2">
      <span
        class="text-xs px-2 py-1 rounded-md bg-gray-600/60 text-gray-200 border border-gray-500">
        {{ task.commissionName }}
      </span>

      @if (task.assignedToName) {
        <div class="tooltip" [attr.data-tip]="task.assignedToName">
          <div class="avatar placeholder">
            <div
              class="bg-primary/80 text-white rounded-full w-8 h-8 flex items-center justify-center font-medium shadow-sm"
            >
              <span>{{ task.assignedToName.charAt(0) }}</span>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Ações inferiores -->
    <div class="flex justify-between items-center text-gray-400 text-xs mt-2 pt-2 border-t border-gray-600/50">
      <div class="flex items-center gap-3">
        <div class="flex items-center gap-1 hover:text-primary transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24"
               stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3" />
          </svg>
          <span>2d</span>
        </div>

        <div class="flex items-center gap-1 hover:text-primary transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24"
               stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M7 8h10M7 12h8m-8 4h6" />
          </svg>
          <span>3 subtarefas</span>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button class="btn btn-ghost btn-xs text-gray-400 hover:text-primary hover:bg-gray-600 rounded-md p-1">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 24 24" stroke="currentColor"
               stroke-width="2" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M5 13l4 4L19 7" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

          }
        </div>
      </div>
    </div>

    <!-- Coluna: Em Execução -->
    <div class="card bg-gray-800 border border-gray-700 shadow-lg">
      <div class="card-body">
        <h2 class="card-title justify-center">
          <span class="badge badge-warning badge-lg text-gray-900 p-3">Em Execução</span>
        </h2>

        <div id="doing" class="space-y-4 min-h-96 p-2 rounded-lg" cdkDropList [cdkDropListData]="doingTasks()" (cdkDropListDropped)="onTaskDrop($event)">
          @for (task of doingTasks(); track task.id) {
            <div
              class="card card-compact bg-gray-700 border-2 border-transparent hover:border-primary shadow-md cursor-grab active:cursor-grabbing transition-all relative rounded-lg"
              cdkDrag
              [cdkDragData]="task"
            >
              <div class="card-body">
                <h3 class="font-semibold text-gray-100">{{ task.title }}</h3>
                <p class="text-sm text-gray-400">{{ task.description }}</p>

                <div class="card-actions justify-between items-center mt-3">
                  <span class="badge badge-outline text-gray-300 border-gray-500">{{ task.commissionName }}</span>

                  @if (task.assignedToName) {
                    <div class="tooltip" [attr.data-tip]="task.assignedToName">
                      <div class="avatar placeholder">
                        <div class="bg-gray-600 text-gray-100 rounded-full w-8 h-8 flex items-center justify-center">
                          <span>{{ task.assignedToName.charAt(0) }}</span>
                        </div>
                      </div>
                    </div>
                  }
                </div>

                <button
                  (click)="onEditTask(task)"
                  class="btn btn-ghost btn-xs absolute top-2 right-2 text-gray-300 hover:bg-gray-600"
                >...</button>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Coluna: Concluída -->
    <div class="card bg-gray-800 border border-gray-700 shadow-lg">
      <div class="card-body">
        <h2 class="card-title justify-center">
          <span class="badge badge-success badge-lg text-white p-3">Concluída</span>
        </h2>

        <div id="done" class="space-y-4 min-h-96 p-2 rounded-lg" cdkDropList [cdkDropListData]="doneTasks()" (cdkDropListDropped)="onTaskDrop($event)">
          @for (task of doneTasks(); track task.id) {
            <div
              class="card card-compact bg-gray-700 border-2 border-transparent hover:border-primary shadow-md cursor-grab active:cursor-grabbing transition-all relative rounded-lg"
              cdkDrag
              [cdkDragData]="task"
            >
              <div class="card-body">
                <h3 class="font-semibold text-gray-100">{{ task.title }}</h3>
                <p class="text-sm text-gray-400">{{ task.description }}</p>

                <div class="card-actions justify-between items-center mt-3">
                  <span class="badge badge-outline text-gray-300 border-gray-500">{{ task.commissionName }}</span>

                  @if (task.assignedToName) {
                    <div class="tooltip" [attr.data-tip]="task.assignedToName">
                      <div class="avatar placeholder">
                        <div class="bg-gray-600 text-gray-100 rounded-full w-8 h-8 flex items-center justify-center">
                          <span>{{ task.assignedToName.charAt(0) }}</span>
                        </div>
                      </div>
                    </div>
                  }
                </div>

                <button
                  (click)="onEditTask(task)"
                  class="btn btn-ghost btn-xs absolute top-2 right-2 text-gray-300 hover:bg-gray-600"
                >...</button>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Formulário -->
  @if (isFormVisible()) {
    <app-task-form
      [taskToEdit]="editingTask()!"
      (close)="onCloseForm()"
    ></app-task-form>
  }
</div>
