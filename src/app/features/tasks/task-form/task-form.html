<dialog class="modal modal-open">
  <div class="modal-box bg-gray-800 text-gray-100 shadow-xl rounded-lg">
    <h3 class="font-bold text-lg mb-2">
      @if (isEditMode) { Editar Tarefa } @else { Nova Tarefa }
    </h3>
    <button
      (click)="close.emit()"
      class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 text-gray-300 hover:text-white"
    >
      ✕
    </button>

    <form (ngSubmit)="onSave()" class="py-4 space-y-4">
      <!-- Título -->
      <div class="form-control">
        <label class="label">
          <span class="label-text text-gray-200">Título da Tarefa</span>
        </label>
        <input
          [(ngModel)]="model.title"
          name="title"
          type="text"
          required
          placeholder="Ex: Redigir ata da reunião"
          class="input w-full border border-gray-600 bg-gray-700 text-gray-100 placeholder-gray-400 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"
        />
      </div>

      <!-- Comissão -->
      <div class="form-control">
        <label class="label">
          <span class="label-text text-gray-200">Comissão</span>
        </label>
        <select
          [(ngModel)]="model.commissionId"
          name="commissionId"
          required
          class="select w-full border border-gray-600 bg-gray-700 text-gray-100 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"
        >
          <option disabled selected value="">Selecione uma comissão</option>
          @for (commission of commissions(); track commission.id) {
            <option [value]="commission.id">{{ commission.name }}</option>
          }
        </select>
      </div>

      <!-- Responsável -->
      <div class="form-control">
        <label class="label">
          <span class="label-text text-gray-200">Responsável (Opcional)</span>
        </label>
        <select
          [(ngModel)]="model.assignedTo"
          name="assignedTo"
          class="select w-full border border-gray-600 bg-gray-700 text-gray-100 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"
        >
          <option [ngValue]="null">Ninguém atribuído</option>
          @for (user of users(); track user.uid) {
            <option [value]="user.uid">{{ user?.email }}</option>
          }
        </select>
      </div>

      <!-- Descrição -->
      <div class="form-control">
        <label class="label">
          <span class="label-text text-gray-200">Descrição (Opcional)</span>
        </label>
        <textarea
          [(ngModel)]="model.description"
          name="description"
          placeholder="Detalhes da tarefa..."
          class="textarea w-full border border-gray-600 bg-gray-700 text-gray-100 placeholder-gray-400 rounded-lg px-4 py-2 h-28 resize-none focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"
        ></textarea>
      </div>

      <!-- Erros -->
      @if (errorMessage) {
        <div
          role="alert"
          class="border border-yellow-600 bg-yellow-900/30 text-yellow-300 rounded-lg px-3 py-2 text-sm"
        >
          <span>{{ errorMessage }}</span>
        </div>
      }
    </form>

    <!-- Ações -->
    <div class="modal-action mt-2">
      <button
        (click)="close.emit()"
        class="btn btn-ghost hover:bg-gray-700 text-white rounded-lg"
      >
        Cancelar
      </button>
      <button
        (click)="onSave()"
        class="btn btn-primary rounded-lg"
        [disabled]="isLoading"
      >
        @if (isLoading) { <span class="loading loading-spinner"></span> }
        Salvar
      </button>
    </div>
  </div>

  <!-- Fechar modal -->
  <form method="dialog" class="modal-backdrop" (click)="close.emit()">
    <button>close</button>
  </form>
</dialog>
