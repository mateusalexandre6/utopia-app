<div class="space-y-6">
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
    <div>
      <h1 class="text-3xl font-bold">Fórum de Discussão e Propostas</h1>
      <p class="text-base-content/70">Participe dos debates e votações da organização.</p>
    </div>
    <button (click)="openNewTopicForm()" class="btn btn-primary shadow-md hover:shadow-lg transition-shadow">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>
      Criar Novo Tópico
    </button>
  </div>

  <div class="divider"></div>

  @if (isLoading()) {
    <div class="grid grid-cols-1 gap-4">
      @for (i of [1,2,3]; track i) {
        <div class="skeleton h-24 w-full rounded-lg"></div>
      }
    </div>
  } @else {
    <div class="space-y-4">
      @for (topic of visibleTopics(); track topic.id) {
        <div class="card card-compact bg-base-100 shadow border border-base-300/50 hover:border-primary/50 hover:shadow-lg transition-all duration-300 animate-fade-in-up cursor-pointer"
             (click)="navigateToTopic(topic.id)">
          <div class="card-body flex-row items-center gap-4 p-4">
            <div class="flex-none">
              @switch (topic.status) {
                @case ('open') { <span class="tooltip" data-tip="Discussão Aberta"><svg class="w-6 h-6 text-success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5.5c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V5z" clip-rule="evenodd" /></svg></span> }
                @case ('voting') { <span class="tooltip" data-tip="Votação em Andamento"><svg class="w-6 h-6 text-warning" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3.5A1.5 1.5 0 018.5 2h3A1.5 1.5 0 0113 3.5v1.164a.97.97 0 01-.137.5L10.21 8.237a.969.969 0 00-.21.5V11h3.5a.75.75 0 01.743.648l.585 3.498A.75.75 0 0114.25 16H5.75a.75.75 0 01-.743-.854l.585-3.498A.75.75 0 016.5 11H10V8.737a.969.969 0 00-.21-.5L7.137 5.164a.97.97 0 01-.137-.5V3.5z" /></svg></span> }
                @case ('closed') { <span class="tooltip" data-tip="Tópico Encerrado"><svg class="w-6 h-6 text-error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" /></svg></span> }
              }
            </div>
            <div class="flex-grow">
              <h2 class="card-title text-base font-semibold link-primary">{{ topic.title }}</h2>
              <p class="text-xs opacity-60">
                Criado por {{ topic.createdByDisplayName }} em {{ topic.createdAt.toDate() | date:'shortDate':'':'pt-BR' }}
                @if (topic.scope === 'organization' && topic.organizationName) {
                  <span class="badge badge-ghost badge-xs ml-2">{{ topic.organizationName }}</span>
                } @else if (topic.scope === 'national') {
                  <span class="badge badge-primary badge-xs ml-2">Nacional</span>
                }
              </p>
            </div>
            <div class="flex-none text-right space-y-1">
              <div class="flex items-center gap-1 tooltip tooltip-left" data-tip="Respostas">
                 <svg class="w-4 h-4 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2c-2.236 0-4.43.18-6.57.524C1.993 2.755 1 4.014 1 5.426v5.148c0 1.413.993 2.67 2.43 2.902.848.138 1.705.248 2.57.331v3.443a.75.75 0 001.28.53l3.58-3.579a.75.75 0 01.53-.218c.265-.008.53-.017.795-.024l.004-.001a9.953 9.953 0 005.993-1.631c1.437-.232 2.43-1.49 2.43-2.902V5.426c0-1.413-.993-2.67-2.43-2.902A16.7 16.7 0 0010 2zm-5.003 10.75a.75.75 0 010-1.5h10.006a.75.75 0 010 1.5H4.997z" clip-rule="evenodd" /></svg>
                 <span class="text-sm font-medium opacity-70">?</span> </div>
              <div class="flex items-center gap-1 tooltip tooltip-left" data-tip="Votos">
                 <svg class="w-4 h-4 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3.5A1.5 1.5 0 018.5 2h3A1.5 1.5 0 0113 3.5v1.164a.97.97 0 01-.137.5L10.21 8.237a.969.969 0 00-.21.5V11h3.5a.75.75 0 01.743.648l.585 3.498A.75.75 0 0114.25 16H5.75a.75.75 0 01-.743-.854l.585-3.498A.75.75 0 016.5 11H10V8.737a.969.969 0 00-.21-.5L7.137 5.164a.97.97 0 01-.137-.5V3.5z" /></svg>
                 <span class="text-sm font-medium opacity-70">?</span> </div>
            </div>
          </div>
        </div>
      } @empty {
        <div class="text-center p-12 bg-base-200/50 rounded-box border-2 border-dashed border-base-300">
          <svg class="w-16 h-16 mx-auto opacity-20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-3.04 8.25-7.625 8.25-1.115 0-2.15-.17-3.125-.465a.75.75 0 01-.375-.63V15.75m-4.125-4.125c-.295-.14-.585-.308-.87-.492a.75.75 0 01-.63-.375c-.217-.43-.338-.9-.338-1.375 0-4.556-3.04 8.25-7.625-8.25 1.115 0 2.15.17 3.125.465a.75.75 0 01.375.63V8.25m4.125 4.125c.295.14.585-.308.87.492a.75.75 0 01.63.375c.217.43.338.9.338-1.375 0-4.556-3.04-8.25-7.625-8.25S4.375 7.444 4.375 12c0 1.115.17 2.15.465 3.125a.75.75 0 01-.63.375c-.43.217-.9.338-1.375.338-4.556 0-8.25-3.04-8.25-7.625S3.444 4.375 8 4.375c1.115 0 2.15.17 3.125.465a.75.75 0 01.375.63V8.25" /></svg>
          <h3 class="text-xl font-bold mt-4">Nenhum tópico encontrado</h3>
          <p class="text-base-content/60">Crie o primeiro tópico para iniciar uma discussão.</p>
        </div>
      }
    </div>
  }
</div>

@if (isTopicFormVisible()) {
  <app-topic-form (close)="onCloseTopicForm()"></app-topic-form>
}

<style>
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .animate-fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
</style>
